<html>
        <head>
                <meta http-equiv="Expires" content="0">
                <meta http-equiv="Pragma" content="no-cache">
                <meta http-equiv="Cache-control" content="no-cache">
                <meta http-equiv="Cache" content="no-cache">
                <meta charset="utf-8">
                <meta name="renderer" content="webkit"> 
                <meta http-equiv="X-UA-Compatible" content="IE=edge">
                <meta name="viewport" content="width=device-width, initial-scale=1">
                <link rel="stylesheet" type="text/css" href="css/media-queries-giwifi.css?t=20180312"/>
                <link rel="stylesheet" type="text/css" href="css/style-giwifi.css?t=20180312"/>
                <link rel="stylesheet" type="text/css" href="css/bootstrap-giwifi.css?t=20180312">
                <script type="text/javascript" src="js/jquery-1.11.1.min.js?t=20180321"></script>
                <script type="text/javascript" src="js/bootstrap-giwifi.js?t=20180312"></script>
                <script type="text/javascript" src="js/detectClient.js?t=20180321"></script>

                <title>欢迎登录GiWiFi</title>

        <script type="text/javascript">
var browser=navigator.appName
var b_version=navigator.appVersion
var iPhone = b_version.indexOf('iPhone') > -1; //是否为iPhone或者QQHD浏览器 
var iPad = b_version.indexOf('iPad') > -1; //是否iPad 
var isiOS = !!b_version.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
var isMac = b_version.indexOf('Macintosh') > -1; //ios终端
var isWinPC = b_version.indexOf('Windows') > -1;
var isAndroid = b_version.indexOf('Android') > -1 || b_version.indexOf('Linux') > -1; //android终端
var isLinux = b_version.indexOf('X11') > -1;

//浏览器版本是否低于IE8
var ie = (function(undefined){ 
    var v = 3, div = document.createElement('div'); 
    while ( 
    div.innerHTML = '<!--[if gt IE '+(++v)+']><I></I><![endif]-->', 
    div.getElementsByTagName('i')[0]); 
    return v> 4 ? v : undefined; 
}());
$( document ).ready(function() {
        if(ie < 8){
                $('body').html('<p style="text-align:center;padding-top:200px">请更新到IE8以上或更现代化的浏览器（如Chrome、Firefox等）进行登陆，谢谢！</p>');
                alert("您的IE浏览器版本太低,建议更换浏览器");
        }
});
</script>

<script type="text/javascript">
//是否强制APP登录认证
//var forceAppEnable = "1";
//var platform = "Windows";
//var netUrl = "http://1.8.1.8";//www.gbcom.com.cn";

</script>
<script type="text/javascript">
        var n_sec = 0; //秒
        var n_min = 0; //分
        var n_hour = 0; //时
 
        //60秒 === 1分
        //60分 === 1小时
        function timer() {
                return setInterval(function () {
         
                        var str_sec = n_sec;
                        var str_min = n_min;
                        var str_hour = n_hour;
                        if ( n_sec < 10) {
                                str_sec = "0" + n_sec;
                        }
                        if ( n_min < 10 ) {
                                str_min = "0" + n_min;
                        }
         
                        if ( n_hour < 10 ) {
                                str_hour = "0" + n_hour;
                        }
         
                        var time = str_hour + ":" + str_min + ":" + str_sec;
                        $("#timer").val(time);
          
                        n_sec++;
                        if (n_sec > 59){
                                n_sec = 0;
                                n_min++;
                        }
                        if (n_min > 59) {
                                n_sec = 0;
                                n_hour++;
                        }        
         
                }, 1000);
        }
         
        var n_timer;// = timer();

        //停止在线时长计时
        function stop() {
                clearInterval(n_timer);
                $("#timer").val("00:00:00");
        }

        //在线时长计时
        function restart(seconds) {
                 clearInterval(n_timer);
                 n_sec = 0;
                 n_min = 0;
                 n_hour = 0;
                 
                 if (seconds<60) {
                         n_sec = seconds;
                 } else if (seconds<3600) {
                         n_min = Math.floor(seconds/60);
                         n_sec = seconds%60;                     
                 } else {
                         n_hour = Math.floor(seconds/3600);
                         var temp = seconds%3600;
                         n_min = Math.floor(temp/60);
                         n_sec = temp%60;
                 }
                 
                 n_timer = timer();
        }

        //根据终端认证状态，显示页面细节
    function fixData(data) {
                var redirect_url = "";
                var app_download_switch = 0;
                var web_auth_switch = 0;
                var portal_oem = "";
                var custom_tips = "";

                if(data.redirect_url)            redirect_url = data.redirect_url;
                if(data.app_download_switch) app_download_switch = data.app_download_switch;

                if (0 == app_download_switch && (redirect_url !== null && redirect_url !== undefined && redirect_url !=='')) {
                        window.location.href=redirect_url;
                        return;
                }

                if(data.web_auth_switch)         web_auth_switch = data.web_auth_switch;
                if(data.portal_oem)              portal_oem = data.portal_oem;
                if(data.custom_tips)             custom_tips = data.custom_tips;

                $("#auth_state").val(data.auth_state);
        $("#online_time").val(data.online_time);

        // add:app_url
        $("#app_url").val(data.app_url);

        $("#redirect_url").val(redirect_url);
        if (portal_oem == "unicom") {
                //
                $(".con_giwifi").css('display','none');
                $(".con_unicom").css('display','');
        
                if (custom_tips !== null && custom_tips !== undefined && custom_tips !== "") {
                        $("#unicom_tips").html(custom_tips);
                } else {
                        $("#unicom_tips").html("微信扫描需右上角选择浏览器打开才能下载!");
                }
        
        } else {
                $(".con_giwifi").css('display','');
                $(".con_unicom").css('display','none');
        
                if (custom_tips !== null && custom_tips !== undefined && custom_tips !== "") {
                        $("#giwifi_tips").html(custom_tips);
                } else {
                        $("#giwifi_tips").html("微信扫描需右上角选择浏览器打开才能下载!");
                }
        }
        
        //这里根据终端当前认证状态，显示按钮内容
        if (2 == data.auth_state) {
                //已认证
                //显示在线时长，并重新启动倒计时
                $("#offlineArea").css('display','');
                $("#authArea").css('display','none');
                restart(data.online_time);
        
                //新增:如果当前认证类型为客户端认证，则不需要显示下载按钮
                if (data.auth_sta_type !== null && data.auth_sta_type !== undefined && data.auth_sta_type !=='') {
                        if (portal_oem == "unicom") {
                                $("#unicom_img").attr('src', 'images/new_unicom_nodown.png'); 
                        } else {
                                $("#giwifi_img").attr('src', 'images/new_giwifi_nodown.png');        
                        }
                }
        
                return;
        }
        
        if (200 == data.auth_state) {
                $("#offlineArea").css('display','none');
                if (web_auth_switch == '1') {
                        $("#authArea").css('display','');
                }
        
                $("#state_msg").html("已连接，上不了网");        
                stop();
        } else if (0 == data.auth_state) { 
                $("#offlineArea").css('display','none');
                if (web_auth_switch == '1') {
                        $("#authArea").css('display','');
                }
        
                $("#state_msg").html("异常，请检查网络");
                stop();
        } else {
                //未认证
                $("#offlineArea").css('display','none');
                if (web_auth_switch == '1') {
                        $("#authArea").css('display','');
                }
        
                $("#state_msg").html("已连接，需要认证");
                stop();
        }
    }
 
         function isUbuntuExplorer() {
                var ua = navigator.userAgent.toLowerCase();
                if(ua.match(/Ubuntu/i)=="ubuntu") {
                        return true;
                } else {
                        return false;
                }
        }

        function initData(){
        //获取终端信息
        var url = "//"+document.domain+"/getApp.htm?action=getAuthState";
        //add:os type
        if (isiOS) url += "&os=ios";
        if (isAndroid) url += "&os=android";
        if (isWinPC) url += "&os=windows";
        if (isMac) url += "&os=mac";
        if (isLinux || isUbuntuExplorer()) url += "&os=linux";

        var param = window.location.search;
    if(param !=null && param.toString().length>1) {
        param = param.substring(1);
        url += "&"+param;
    }
        
        $.ajax({
        url: url,
        dataType:'json',
        success: function(data) {
                c = eval('(' + data.data + ')');
                if(data.resultCode == 0){
                        fixData(c);
                }else {
                        //尝试重定向
                        //window.top.location.href = netUrl;
                }
            return false;
        },
        error:function(data) {
                return false;
        },
        cache: false
    });
}

$(document).ready(function(){
        initData();
});
   
    //用户认证上线或者主动下线
    function loginout() {
        var auth_state = $("#auth_state").val();
        var redirect_url = $('#redirect_url').val();
    
        if (2 == auth_state) {
                //已认证
                //下线
                var address = "//"+document.domain+"/getApp.htm?action=logout";
                var param = window.location.search;
                if(param !=null && param.toString().length>1) {
                        param = param.substring(1);
                        address += "&"+param;
                }
                //window.location.href=address;
        
                $.ajax({
                url: address,
                dataType:'json',
                success: function(data) {
                        if(data.resultCode == 0){
                                alert("下线成功！");
                        }else {
                                alert("下线失败！");
                        }
                
                        //重新加载界面
                        window.location.reload();
                    return false;
                },
                error:function(data) {
                        return false;
                },
                cache: false
            });
        
        } else {
                //未认证
                //var address = netUrl;
                //window.location.href=address;
                window.location.href=redirect_url;
        }
    }
    
</script>

<script type="text/javascript">

function downApp() {
        var app_url = $("#app_url").val();        

        var number = 4;
        if(isAndroid){
                if(isWeixinExplorer()){
                        //is true 点击下载时弹出遮罩层
                        $(this).removeAttr("href");
                        $("#menu").attr("src","images/weixin_android.png?t="+number+"'/>");
                        document.getElementById('layer').style.display='block';
                        return false;
                }else{
                        window.location.href = app_url;
                }
        } else if(isiOS){
                //
                var ver = client.osversion;
        if(ver<7) {
           alert("低版本苹果终端(ios 7.0以下)不支持安装APP！");
           return false;
        } 
        
                if(isWeixinExplorer()){
                        //is true 点击下载时弹出遮罩层
                        $(this).removeAttr("href");
                        $("#menu").attr("src",'images/weixin_ios.png?t='+number+'');
                        document.getElementById('layer').style.display='block';
                        return false;
                }
                if(isIosWiFiMasterKeyExplorer()){
                        // is true 点击下载时弹出遮罩层
                        $(this).removeAttr("href");
                        $('#menu').attr("src","images/wifi_android.png?t="+number+"'/>");
                        document.getElementById('layer').style.display='block';
                        return false;
                }

                if(ver >= 9){
                        //document.getElementById('ios_layer').style.display='block';
                        //return false;
                } else {
                        //window.location.href=address;

                        //checkClick();
                }
                window.location.href = app_url;
        } else if(isWinPC) {
                window.location.href = app_url;
        } else if(isMac) {
                window.location.href = app_url;
        } else {
                alert("当前还没有符合您终端类型的客户端软件下载！");
                return false;
        }
}

$(document).ready(function(){
        $(".downApp").on("click",function(){
                downApp();
        });

        $("#closeLayer").on("click",function(){
                document.getElementById('layer').style.display='none';
        });
});

//调用android方法
window.auth_obj.load();

// ios主动调用
function auth_obj_load() {
        return true;
}

//检查是否重复点击ios下载
function checkClick() {
    var app_url = $("#app_url").val();
    var  item = document.getElementById('cc'); 
    if (item.value == 0) { 
        item.value=1;
        browserRedirect('http://down.gwifi.com.cn/getApp.htm?os=ios');  
        return true;
    }

    if(confirm("APP应该正在下载安装中，请切换到手机桌面看一下。您是否确定重新下载APP吗？")) {
        browserRedirect('http://down.gwifi.com.cn/getApp.htm?os=ios');
    }
    return true;
}

//检查是否是微信内置浏览器
function isWeixinExplorer(){
        var ua = navigator.userAgent.toLowerCase();
        if(ua.match(/MicroMessenger/i)=="micromessenger") {
                return true;
        } else {
                return false;
        }
}

//检查是否是WIFI万能钥匙内置浏览器
function isWiFiMasterKeyExplorer(){
        var ua = navigator.userAgent.toLowerCase();
        if(ua.match('wkbrowser')=="wkbrowser") {
                return true;
        }else{
                return false;
        }
}

//检查wifi万能钥匙是苹果版
function isIosWiFiMasterKeyExplorer(){
        var ua = navigator.userAgent.toLowerCase();
        if(ua.match(/wifikey/i) == "wifikey") {
                return true;
        }else{
                return false;
        }
}

//检查尝试自动打开app
function auto_app(){
        if (iPhone || iPad || isiOS) {
                $("#auto").attr("src","gbcom://com.gbcom.gwifi");
                //window.location.href = "gbcom://com.gbcom.gwifi";
    
    }
        // 如果是WIFI万能钥匙APP那么不执行自动调用APP
        if(!isWiFiMasterKeyExplorer()){
                if (isAndroid) {
                        $("#auto").attr("src","gbcom://com.gbcom.gwifi");
                }
        }
}

//重定向
function browserRedirect(path){
    var sUserAgent = navigator.userAgent.toLowerCase();
    var bIsIpad = sUserAgent.match(/ipad/i) == "ipad";
    var bIsIphoneOs = sUserAgent.match(/iphone os/i) == "iphone os";
    var bIsMidp = sUserAgent.match(/midp/i) == "midp";
    var bIsUc7 = sUserAgent.match(/rv:1.2.3.4/i) == "rv:1.2.3.4";
    var bIsUc = sUserAgent.match(/ucweb/i) == "ucweb";
    var bIsAndroid = sUserAgent.match(/android/i) == "android";
    var bIsCE = sUserAgent.match(/windows ce/i) == "windows ce";
    var bIsWM = sUserAgent.match(/windows mobile/i) == "windows mobile";
    if (!(bIsIpad || bIsIphoneOs || bIsMidp || bIsUc7 || bIsUc || bIsAndroid || bIsCE || bIsWM)) {
        window.open(path);
    }else{
                window.location.href = path;
        }
}
</script>

<script type="text/javascript">
        $( document ).ready(function() {
                //如果有app则跳转
                auto_app();
        });

</script>

<script type="text/javascript">
    //点击关闭时隐藏遮罩层
    function close_layer(){
        document.getElementById('layer').style.display='none';
                document.getElementById('ios_layer').style.display='none';
    }
</script>

</head>

<body style="">
<!--整体开始--->
<!--遮罩层 开始--->
<div id="layer" onclick="close_layer()">
        <div class="layer_img">
                        <img id="menu" onclick="close_layer();">
                        <a class="img_close" id="closeLayer"></a>
        </div>
</div>
<input id="cc" name="cc" value="0" type="hidden">
<!--IOS9下载提醒 开始--->
<div id="ios_layer">
        <div class="ios_layer_img">
                <img src="images/ios9.png">
                <!--关闭图标-->
                <a class="close_ios_img" onclick="close_layer()"></a>
                <!--下载按钮-->
                <a class="ios_dowm btn btn-info btn-lg btn-block" onclick="checkClick();">安全下载APP</a>
        </div>
</div>
<!---IOS9下载提醒 结束--->
<div id="portal">

        <!-- <div style="clear:both;"></div> -->
        <input type="hidden" id="auth_state" name="auth_state" />
        <input type="hidden" id="online_time" name="online_time" />
        <input type="hidden" id="redirect_url" name="redirect_url" />
        <!-- add:app_url  -->
        <input type="hidden" id="app_url" name="app_url" />

        <div id="offlineArea" class="clearfix"  style=";padding: 10px;display:none">
                <div class="pull-left" style="line-height:35px;">
                        <img src="images/time.png" width="20px">
                        在线时长：<input type="text" id="timer" style="border:0px;background-color:transparent;width:120px;" value="00:00:00">
                </div>
                <div class="pull-right">
                        <a class="btn btn-danger" href="javascript:loginout();">下线</a>
                </div>
        </div>

        <div class="con_app_phone">
                <!-- giwifi开始 -->
                <div class="con_giwifi">
                        <div class="giwifi_warn">友情提醒:<span id="giwifi_tips"></span></div>
                        <img id="giwifi_img" src="images/new_giwifi_tip.png">
                        <!---下载按钮开始--->
                        <div class="app_down_giwifi">
                                <a class="phone_down_giwifi clickmark" id="downApp" href="javascript:downApp();"></a>
                        </div>
                        <!---下载按钮结束--->
                </div>
                <!---giwifi结束--->

                <!-- 联通开始 -->
                <div class="con_unicom" style="display:none">
                        <div class="unicom_warn">友情提醒:<span id="unicom_tips"></span></div>
                        <img id="unicom_img" src="images/new_unicom_tip.png">
                        <!---下载按钮开始--->
                        <div class="app_down_unicom">
                                <a class="phone_down_unicom clickmark" id="downApp" href="javascript:downApp();"></a>
                        </div>
                        <!---下载按钮结束--->
                </div>
                <!---联通结束--->

        </div>
        <!---内容部分结束--->

        <div id="state_msg" style="margin-top:10px;text-align:center;"></div>
        <div id="authArea" style="margin-top:20px;text-align:center;display:none">
                <a class="btn btn-danger" href="javascript:loginout();" style="width:50%;">网页登录</a>
        </div>
    <!---尾部联系信息开始--->
    <div class="main_footer" style="margin-top:35px;">
                <ul>
                        <li class="main_footer_msg">投诉建议：400-038-5858 </li>
                </ul>
    </div>
    <!---尾部联系信息结束--->
        <!-- 加载自动打开app -->
        <iframe id="auto" style="display:none"></iframe>
        <!-- 加载自动打开app -->
        <iframe src="subpage/auto.html" style="display:none"></iframe>
</div>
<!---整体结束--->

</body>

</html>
